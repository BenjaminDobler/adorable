<div class="app-container" 
     [class.selecting]="isSelecting"
     (mousedown)="onMouseDown($event)"
     (mousemove)="onMouseMove($event)"
     (mouseup)="onMouseUp()">
  
  <div class="sidebar">
    <div class="header">
      <div class="header-top">
        <button class="btn-back" (click)="goBack()">â† Back</button>
        <h1>{{ projectName }}</h1>
      </div>
    </div>
    
    <div class="chat-area">
      <div class="project-controls">
        <button (click)="saveProject()" [disabled]="loading() || !currentFiles" class="icon-btn" title="Save Project">
          ğŸ’¾
        </button>
        <button (click)="downloadZip()" [disabled]="loading() || !currentFiles" class="icon-btn" title="Download ZIP">
          â¬‡ï¸
        </button>
      </div>

      <div class="input-wrapper" 
           [class.dragging]="isDragging"
           (drop)="onDrop($event)"
           (dragover)="onDragOver($event)"
           (dragleave)="onDragLeave($event)">
        
        <textarea 
          [(ngModel)]="prompt" 
          placeholder="e.g., Create a todo list with signals and tailwind..."
          [disabled]="loading()">
        </textarea>
        
        <div class="toolbar">
          <input type="file" #fileInput (change)="onFileSelected($event)" accept="image/*" style="display: none" />
          <button (click)="fileInput.click()" class="icon-btn small" title="Upload Image" [disabled]="loading()">
            ğŸ“
          </button>
          <button (click)="startSelection()" class="icon-btn small" title="Select Area to Edit" [disabled]="!webContainerService.url()">
            â›¶
          </button>
        </div>

        @if (attachedImage) {
          <div class="attachment-preview">
            <img [src]="attachedImage | safeUrl" />
            <button class="remove-btn" (click)="removeAttachment()">Ã—</button>
          </div>
        }
      </div>

      <button (click)="generate()" [disabled]="loading() || !prompt" class="generate-btn">
        {{ loading() ? 'Generating...' : 'Generate App' }}
      </button>
    </div>

    <div class="terminal-container">
      <h3>Terminal Output</h3>
      <pre class="terminal"><code>{{ webContainerService.output() }}</code></pre>
    </div>
  </div>

  <div class="preview-area">
    @if (webContainerService.url()) {
      <iframe [src]="webContainerService.url() | safeUrl"></iframe>
    } @else {
      <div class="placeholder">
        @if (loading()) {
          <div class="spinner"></div>
          <p>Claude is building your app... This takes about 30-60 seconds.</p>
        } @else {
          <p>Your generated app will appear here.</p>
        }
      </div>
    }
    
    <!-- Marquee Overlay -->
    @if (isSelecting && selectionRect) {
      <div class="selection-box" [style.left.px]="selectionRect.x" [style.top.px]="selectionRect.y" [style.width.px]="selectionRect.width" [style.height.px]="selectionRect.height"></div>
    }
  </div>
</div>
