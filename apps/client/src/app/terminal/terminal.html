<div class="terminal-view">
  <div class="terminal-tabs">
    <button (click)="terminalTab.set('server')" 
            [class.active]="terminalTab() === 'server'"
            class="tab-btn">
      Server Logs
    </button>
    <button (click)="terminalTab.set('shell')" 
            [class.active]="terminalTab() === 'shell'"
            class="tab-btn">
      Interactive Shell
    </button>
    <button (click)="terminalTab.set('console')" 
            [class.active]="terminalTab() === 'console'"
            class="tab-btn">
      Preview Console
    </button>
  </div>
  
  @if (terminalTab() === 'server') {
    <div class="terminal-header">
      <button class="btn-clear" (click)="webContainerService.clearServerOutput()">Clear</button>
      <div style="display: flex; gap: 12px; align-items: center;">
        <span style="font-size: 10px; color: var(--text-muted); text-transform: uppercase; font-weight: 700; letter-spacing: 0.05em;">Dev Server</span>
        @if (webContainerService.url()) {
          <button (click)="restartDevServer()" class="btn-toggle-server restart" [disabled]="restarting()" title="Restart Dev Server">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="23 4 23 10 17 10"></polyline>
              <path d="M20.49 15a9 9 0 1 1-2.12-9.36L23 10"></path>
            </svg>
          </button>
          <button (click)="webContainerService.stopDevServer()" class="btn-toggle-server running" title="Stop Dev Server">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="currentColor" stroke-width="0"><rect x="6" y="6" width="12" height="12"></rect></svg>
          </button>
        } @else {
          <button (click)="webContainerService.startDevServer()" class="btn-toggle-server stopped" title="Start Dev Server">
            <svg viewBox="0 0 24 24" width="14" height="14" stroke="currentColor" fill="currentColor" stroke-width="0"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
          </button>
        }
      </div>
    </div>
    <div class="terminal-window">
      <code [innerHTML]="webContainerService.serverOutput() | terminalFormat"></code>
    </div>
  }

  @if (terminalTab() === 'shell') {
    <div class="terminal-header">
      <button class="btn-clear" (click)="webContainerService.clearShellOutput()">Clear</button>
    </div>
    <div class="terminal-window">
      <code [innerHTML]="webContainerService.shellOutput() | terminalFormat"></code>
    </div>
    <div class="terminal-input-area">
      <span class="prompt">$</span>
      <input 
        [(ngModel)]="terminalInput" 
        (keydown.enter)="sendTerminalCommand()"
        placeholder="Run command..."
      />
    </div>
  }
  
  @if (terminalTab() === 'console') {
    <div class="terminal-header">
      <button (click)="toggleDebug.emit()" class="btn-clear" style="margin-right: 8px;">üîç Debug</button>
      <button class="btn-clear" (click)="webContainerService.clearPreviewLogs()">Clear</button>
    </div>
    
    <div class="terminal-window">
      @for (log of webContainerService.previewConsoleLogs(); track $index) {
        <div [style.color]="log.level === 'error' ? 'var(--error-color)' : log.level === 'warn' ? '#eab308' : '#e5e7eb'" 
             style="font-family: 'JetBrains Mono', monospace; font-size: 12px; margin-bottom: 6px; border-bottom: 1px solid rgba(255,255,255,0.03); padding-bottom: 4px;">
          <span style="opacity: 0.4; margin-right: 8px;">{{ log.timestamp | date:'HH:mm:ss' }}</span>
          <span style="white-space: pre-wrap;">{{ log.message }}</span>
        </div>
      }
      @if (webContainerService.previewConsoleLogs().length === 0) {
         <div style="color: var(--text-muted); text-align: center; padding-top: 3rem; font-size: 13px; font-weight: 500;">No console logs yet</div>
      }
    </div>
  }
</div>
